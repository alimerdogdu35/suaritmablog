{% extends "base.twig" %}

{% block title %}Giriş Yap - Maviro{% endblock %}

{% block content %}
<main class="flex flex-col items-center justify-center min-h-screen pt-24 pb-8 bg-gray-100">
    <div class="bg-white p-8 md:p-12 rounded-xl shadow-2xl w-full max-w-md border border-blue-100">
        
        <h1 class="text-3xl font-extrabold text-center text-blue-900 mb-6">Hesabınıza Giriş Yapın</h1>

        <form action="/login" id="loginForm" name="loginForm" method="POST" class="space-y-6">
            <div>
                <label for="email" class="block text-blue-900 font-semibold mb-2">E-posta Adresi</label>
                <input type="email" id="email" name="email" placeholder="ornek@email.com" required
                       class="w-full px-4 py-3 rounded-xl border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition duration-300 bg-white/90 placeholder:text-gray-500" />
            </div>
            
            <div>
                <label for="password" class="block text-blue-900 font-semibold mb-2">Şifre</label>
                <input type="password" id="password" name="password" placeholder="Şifreniz" required
                       class="w-full px-4 py-3 rounded-xl border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition duration-300 bg-white/90 placeholder:text-gray-500" />
            </div>

            <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition duration-300 ease-in-out transform hover:scale-105">
                Oturum Aç
            </button>
        </form>

        <p class="mt-6 text-center text-gray-600">
            Hesabınız yok mu? 
            <a href="/register" class="text-blue-600 hover:text-blue-800 font-semibold transition duration-300">
                Hesap Oluştur
            </a>
        </p>

    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  

    const loginForm = document.getElementById("loginForm");

    if (loginForm) {
        loginForm.addEventListener("submit", async function(e) {
            e.preventDefault(); // Sayfanın yeniden yüklenmesini engeller

            const formData = new FormData(loginForm);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                // Yanıtın durum kodunu kontrol et
                if (response.ok) {
                    // Yanıt başarılıysa (örneğin 200 OK), sunucunun döndürdüğü
                    // yönlendirme URL'sini alalım (bu daha iyi bir yaklaşımdır).
                    const result = await response.json();
                    if (result.redirect) {
                        window.location.href = result.redirect;
                    }
                } else {
                    // Yanıt bir hata koduysa (4xx, 5xx),
                    // hata mesajını doğrudan SweetAlert ile göster.
                    if (response.status === 401) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata!',
                            text: 'E-posta veya şifre yanlış.',
                            confirmButtonText: 'Tamam'
                        });
                    } else {
                        // Diğer hata durumlarını (örn: 400, 500) JSON'dan okuyalım.
                        const errorResult = await response.json();
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata!',
                            text: errorResult.message || 'Bilinmeyen bir hata oluştu.',
                            confirmButtonText: 'Tamam'
                        });
                    }
                }

            } catch (error) {
                console.error("Giriş sırasında bir hata oluştu:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Sunucu Hatası!',
                    text: 'Giriş işlemi sırasında bir sunucu hatası oluştu.',
                    confirmButtonText: 'Tamam'
                });
            }
        });
    }
});
</script>
{% endblock %}