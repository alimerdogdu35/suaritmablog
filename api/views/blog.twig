{% extends "base.twig" %}

{% block title %}Blog - Maviro{% endblock %}

{% block head %}
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Su Arıtma Sistemleri Blogu | Sağlıklı Su İçin Bilgiler</title>
<meta name="description" content="Su arıtma cihazları hakkında güncel içerikler: ürün karşılaştırmaları, montaj rehberi, filtre değişimi, bakım ipuçları ve sağlık faydaları." />
<meta name="keywords" content="su arıtma, ters ozmoz, filtre değişimi, montaj, bakım, sağlıklı su, arıtma cihazı" />
<meta name="author" content="Su Arıtma Blog" />

<meta property="og:title" content="Su Arıtma Sistemleri Blogu" />
<meta property="og:description" content="Ürün karşılaştırmaları, montaj rehberi ve bakım ipuçları." />
<meta property="og:type" content="website" />
<meta property="og:locale" content="tr_TR" />

<link rel="stylesheet" href="/style.css" />
{% endblock %}

{% block content %}
<style>
:root {
  --primary-blue: #1d4ed8;
  --secondary-blue: #2563eb;
  --light-blue: #eff6ff;
  --border-color: #d1d5db;
  --text-gray: #6b7280;
  --text-dark: #374151;
}
.blog-header {
  position: relative;
  text-align: center;
  color: #fff;
  height: 400px;
  background-image: url('images/blog.jpg');
  background-size: cover;
  background-position: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.blog-header::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.3);
  z-index:0;
}
.blog-header h1, .blog-header p {
  position: relative;
  z-index: 1;
  text-shadow: 1px 1px 5px rgba(0,0,0,0.4);
}
.blog-header h1 { margin:0 0 12px; font-size: clamp(28px,4vw,50px); font-weight:700; }
.blog-header p { margin:0; font-size: clamp(16px,2vw,22px); opacity:.95; }

.blog-controls { max-width:1100px; margin:18px auto; padding:0 16px; display:grid; gap:10px; }
.filters { display:flex; gap:8px; flex-wrap:wrap; }
.filters button { padding:8px 14px; border:1px solid var(--secondary-blue); background: var(--light-blue); color: var(--primary-blue); border-radius:10px; cursor:pointer; }
.filters button.active { background: var(--secondary-blue); color:#fff; }
.searchbar { width:100%; display:flex; gap:8px; }
.searchbar input { flex:1; padding:12px; border:1px solid var(--border-color); border-radius:10px; }

.blog-container { max-width:1100px; margin:8px auto 24px; padding:0 16px; display:grid; gap:16px; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); }
.card { border:1px solid var(--border-color); border-radius:12px; padding:14px; background:#fff; display:flex; flex-direction:column; gap:10px; transition: box-shadow 0.2s ease; height:100%; }
.card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.06); }
.card img { width:100%; height:180px; object-fit:cover; border-radius:10px; background:#f3f4f6; }
.card h2 { font-size:18px; color: var(--primary-blue); margin:0; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
.card p { overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; flex-grow:1; }
.read-more { align-self:flex-start; text-decoration:none; color:var(--secondary-blue); font-weight:700; margin-top:auto; }

.pagination { display:flex; justify-content:center; gap:6px; margin:18px 0 36px; }
.pagination button { padding:8px 12px; border:1px solid var(--border-color); background:#fff; border-radius:8px; cursor:pointer; }
.pagination button[disabled] { opacity:.5; cursor:not-allowed; }
.pagination .page.active { background: var(--secondary-blue); color:#fff; border-color: var(--secondary-blue); }

.cta { max-width:1100px; margin:0 auto 40px; padding:16px; border:1px dashed var(--secondary-blue); border-radius:12px; background:#f8fbff; }
.cta h3 { margin:0 0 6px; color: var(--primary-blue); }
.cta p { margin:0 0 10px; color:#4b5563; }
.cta .btn { display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid var(--secondary-blue); color:#fff; background: var(--secondary-blue); text-decoration:none; font-weight:700; }
</style>

<header class="blog-header" role="banner">
  <h1>Su Arıtma Blogu</h1>
  <p>Sağlıklı su için en doğru bilgiyi buradan öğrenin</p>
</header>

<section class="blog-controls" aria-label="Blog Kontrolleri">
  <div class="searchbar">
    <input id="searchInput" type="search" placeholder="Bloglarda ara..." aria-label="Blog ara" />
  </div>
  <div class="filters" role="tablist" aria-label="Kategoriler">
    <button class="active" data-category="all" role="tab" aria-selected="true">Tümü</button>
    <button data-category="urun" role="tab">Ürünler</button>
    <button data-category="montaj" role="tab">Montaj</button>
    <button data-category="bakim" role="tab">Bakım</button>
    <button data-category="faydalar" role="tab">Faydalar</button>
  </div>
</section>

<section id="blogContainer" class="blog-container" aria-live="polite">
  {% for post in posts %}
  <article class="card" data-slug="{{ post.slug }}" data-category="{{ post.category }}" data-title="{{ post.title }}" data-excerpt="{{ post.excerpt }}">
    <a href="/blog/{{ post.slug }}">
      <img src="{{ post.image }}" alt="{{ post.title }}" loading="lazy"/>
    </a>
    <div class="meta">Kategori: {{ post.category|capitalize }} | {{ post.date|date("d F Y") }}</div>
    <h2>{{ post.title }}</h2>
    <p>{{ post.excerpt }}</p>
    <a href="/blog/{{ post.slug }}" class="read-more">Devamını Oku →</a>
  </article>
  {% endfor %}
</section>

<nav class="pagination" id="pagination" aria-label="Sayfalama"></nav>

<div class="cta" role="complementary">
  <h3>Aradığınız konuyu bulamadınız mı?</h3>
  <p>Uzman ekibimiz sorularınızı yanıtlamaya hazır. Bize yazın, cihaz seçimi ve montaj konusunda yol gösterelim.</p>
  <a class="btn" href="/iletisim">İletişime Geçin</a>
</div>

<script>
const PAGE_SIZE=6;
const container=document.getElementById('blogContainer');
const pager=document.getElementById('pagination');
const searchInput=document.getElementById('searchInput');
const filterButtons=Array.from(document.querySelectorAll('.filters button'));

let posts=Array.from(document.querySelectorAll('.card')).map(c=>({
  id: c.dataset.id,
  category: c.dataset.category,
  title: c.dataset.title,
  excerpt: c.dataset.excerpt
}));
let state={page:1,q:'',cat:'all'};

function matches(post){
  const catOK=state.cat==='all'||post.category===state.cat;
  const q=state.q.trim().toLowerCase();
  if(!q) return catOK;
  return (post.title+' '+post.excerpt).toLowerCase().includes(q)&&catOK;
}

function paginate(list,page,size){
  const total=list.length;
  const pages=Math.max(1,Math.ceil(total/size));
  const p=Math.min(Math.max(1,page),pages);
  const start=(p-1)*size;
  return {page:p,pages,total,items:list.slice(start,start+size)};
}

function renderCards(list){
  container.innerHTML='';
  if(list.length===0){
    container.innerHTML='<p style="text-align:center;color:#888;">Aradığınız kriterlere uygun yazı bulunamadı.</p>';
    pager.style.display='none';
    return;
  }
  pager.style.display='flex';
  list.forEach(p=>{
    const card=document.createElement('article');
    card.className='card';
    card.setAttribute('data-id',p.id);
    card.setAttribute('data-category',p.category);
    card.innerHTML=`<a href="/blog/${p.id}"><img src="${p.image}" alt="${p.title}" loading="lazy"/></a>
    <div class="meta">Kategori: ${p.category}</div>
    <h2>${p.title}</h2>
    <p>${p.excerpt}</p>
    <a href="/blog/${p.id}" class="read-more">Devamını Oku →</a>`;
    container.appendChild(card);
  });
}

function renderPager(page,pages){
  pager.innerHTML='';
  const prev=document.createElement('button'); prev.textContent='Önceki'; prev.disabled=page<=1; prev.addEventListener('click',()=>{state.page=Math.max(1,state.page-1);update();}); pager.appendChild(prev);
  for(let i=1;i<=pages;i++){ const btn=document.createElement('button'); btn.className='page'+(i===page?' active':''); btn.textContent=i; btn.addEventListener('click',()=>{state.page=i;update();}); pager.appendChild(btn); }
  const next=document.createElement('button'); next.textContent='Sonraki'; next.disabled=page>=pages; next.addEventListener('click',()=>{state.page=Math.min(pages,state.page+1);update();}); pager.appendChild(next);
}

function update(){
  const filtered=posts.filter(matches);
  const {page,pages,items}=paginate(filtered,state.page,PAGE_SIZE);
  state.page=page;
  renderCards(items);
  renderPager(page,pages);
}

searchInput.addEventListener('input',()=>{ state.q=searchInput.value; state.page=1; update(); });
filterButtons.forEach(btn=>btn.addEventListener('click',()=>{
  filterButtons.forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false');});
  btn.classList.add('active'); btn.setAttribute('aria-selected','true');
  state.cat=btn.dataset.category; state.page=1; update();
}));

update();
</script>
{% endblock %}
